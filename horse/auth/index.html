
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../api/">
      
      
        <link rel="next" href="../../tiger/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>Authentication - Joint Online Judge</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#authentication" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Joint Online Judge" class="md-header__button md-logo" aria-label="Joint Online Judge" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Joint Online Judge
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authentication
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/joint-online-judge/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    joint-online-judge
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Joint Online Judge
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../developer/" class="md-tabs__link">
      Developer's Guide
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../GradeWithJOJ/" class="md-tabs__link">
        GradeWithJOJ
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../cattle/learning/" class="md-tabs__link">
        Cattle
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../elephant/" class="md-tabs__link">
        Elephant
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Horse
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../tiger/" class="md-tabs__link">
        Tiger
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Joint Online Judge" class="md-nav__button md-logo" aria-label="Joint Online Judge" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Joint Online Judge
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/joint-online-judge/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    joint-online-judge
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Joint Online Judge
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../developer/" class="md-nav__link">
        Developer's Guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          GradeWithJOJ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          GradeWithJOJ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/" class="md-nav__link">
        Grade with JOJ 1.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/1.Create%20Domain/" class="md-nav__link">
        Create Domain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/2.Member%20Management/" class="md-nav__link">
        Member managemet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/3.Create%20and%20Set%20Problem/" class="md-nav__link">
        Create and set problem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/4.Create%20and%20Set%20Homework/" class="md-nav__link">
        Create and Set Homework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/5.Judge/" class="md-nav__link">
        Judge
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/6.Export/" class="md-nav__link">
        Export
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/7.Moss/" class="md-nav__link">
        Moss Code Check
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../GradeWithJOJ/8.Contact/" class="md-nav__link">
        Contact
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Cattle
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Cattle
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cattle/learning/" class="md-nav__link">
        Learning Path
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cattle/structure/" class="md-nav__link">
        Project Structure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Elephant
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Elephant
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elephant/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Horse
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Horse
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API Reference
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Authentication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Authentication
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#query-parameters" class="md-nav__link">
    Query Parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process" class="md-nav__link">
    Process
  </a>
  
    <nav class="md-nav" aria-label="Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauth2-login" class="md-nav__link">
    OAuth2 Login
  </a>
  
    <nav class="md-nav" aria-label="OAuth2 Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-oauth2-clients" class="md-nav__link">
    List OAuth2 Clients
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login" class="md-nav__link">
    Login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-login-status" class="md-nav__link">
    Check Login Status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-login-experimental" class="md-nav__link">
    Password Login (Experimental)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register" class="md-nav__link">
    Register
  </a>
  
    <nav class="md-nav" aria-label="Register">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-by-username-and-password" class="md-nav__link">
    Register by Username and Password
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-by-oauth" class="md-nav__link">
    Register by OAuth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logout-experimental" class="md-nav__link">
    Logout (Experimental)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#refresh-and-fresh-token-experimental" class="md-nav__link">
    Refresh and Fresh Token (Experimental)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link-account-with-oauth-not-implemented" class="md-nav__link">
    Link Account with OAuth (Not Implemented)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backends" class="md-nav__link">
    Backends
  </a>
  
    <nav class="md-nav" aria-label="Backends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cookie-authentication" class="md-nav__link">
    Cookie Authentication
  </a>
  
    <nav class="md-nav" aria-label="Cookie Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-authentication" class="md-nav__link">
    HTTP Authentication
  </a>
  
    <nav class="md-nav" aria-label="HTTP Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction_1" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage_1" class="md-nav__link">
    Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-jwt" class="md-nav__link">
    Why JWT?
  </a>
  
    <nav class="md-nav" aria-label="Why JWT?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#header" class="md-nav__link">
    Header
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payload" class="md-nav__link">
    Payload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature" class="md-nav__link">
    Signature
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    Security
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#third-party-login-support" class="md-nav__link">
    Third-party Login Support
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Tiger
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Tiger
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tiger/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#query-parameters" class="md-nav__link">
    Query Parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process" class="md-nav__link">
    Process
  </a>
  
    <nav class="md-nav" aria-label="Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauth2-login" class="md-nav__link">
    OAuth2 Login
  </a>
  
    <nav class="md-nav" aria-label="OAuth2 Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-oauth2-clients" class="md-nav__link">
    List OAuth2 Clients
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login" class="md-nav__link">
    Login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-login-status" class="md-nav__link">
    Check Login Status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-login-experimental" class="md-nav__link">
    Password Login (Experimental)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register" class="md-nav__link">
    Register
  </a>
  
    <nav class="md-nav" aria-label="Register">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-by-username-and-password" class="md-nav__link">
    Register by Username and Password
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-by-oauth" class="md-nav__link">
    Register by OAuth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logout-experimental" class="md-nav__link">
    Logout (Experimental)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#refresh-and-fresh-token-experimental" class="md-nav__link">
    Refresh and Fresh Token (Experimental)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link-account-with-oauth-not-implemented" class="md-nav__link">
    Link Account with OAuth (Not Implemented)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backends" class="md-nav__link">
    Backends
  </a>
  
    <nav class="md-nav" aria-label="Backends">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cookie-authentication" class="md-nav__link">
    Cookie Authentication
  </a>
  
    <nav class="md-nav" aria-label="Cookie Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-authentication" class="md-nav__link">
    HTTP Authentication
  </a>
  
    <nav class="md-nav" aria-label="HTTP Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction_1" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage_1" class="md-nav__link">
    Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-jwt" class="md-nav__link">
    Why JWT?
  </a>
  
    <nav class="md-nav" aria-label="Why JWT?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#header" class="md-nav__link">
    Header
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payload" class="md-nav__link">
    Payload
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature" class="md-nav__link">
    Signature
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    Security
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#third-party-login-support" class="md-nav__link">
    Third-party Login Support
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h1>
<p>The authentication is based on <a href="https://jwt.io/">JWT</a> (JSON Web Tokens)
, <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">Cookie</a> and
and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication">HTTP Authentication Framework</a>
.</p>
<h2 id="query-parameters">Query Parameters<a class="headerlink" href="#query-parameters" title="Permanent link">&para;</a></h2>
<p>Most endpoints under <code>/auth</code> use the same set of query parameters:</p>
<ul>
<li>cookie (boolean) - If set to true (by default), the server will add Set/Delete-Cookie
  on response header. This works on direct call to the api in the browser, and also
  works on most browsers in fetch/XHR requests.</li>
<li>response_type (string, required) - one of "redirect" and "json". If set to "redirect",
  the response will be an HTTP redirect response, which is used for direct call to the
  api in the browser; if set to "json", the response will be a JSON response, which is
  mostly used for fetch/XHR requests in clients.</li>
<li>redirect_url (string) - the redirect url used in redirect response if <code>response_type</code>
  is "redirect". The default value is the host name of the server. It has no effect on
  other <code>response_type</code>.</li>
</ul>
<h2 id="process">Process<a class="headerlink" href="#process" title="Permanent link">&para;</a></h2>
<h3 id="oauth2-login">OAuth2 Login<a class="headerlink" href="#oauth2-login" title="Permanent link">&para;</a></h3>
<h4 id="list-oauth2-clients">List OAuth2 Clients<a class="headerlink" href="#list-oauth2-clients" title="Permanent link">&para;</a></h4>
<p>You can use this api to get a list of supported OAuth2 clients on the server:</p>
<p><code>GET /api/v1/oauth2</code></p>
<h4 id="login">Login<a class="headerlink" href="#login" title="Permanent link">&para;</a></h4>
<p>First, you should call this api to get a redirect url for the OAuth process:</p>
<p><code>GET /api/v1/oauth2/&lt;oauth_name&gt;/authorize?response_type=redirect</code></p>
<p>In most case, <code>response_type</code> should be set to "redirect" because OAuth requires a
redirection to a third-party server and redirects you back to the server. <code>cookie</code>
should be set to true because you must do so preserve the state during redirections. The
user will be redirected to the <code>redirect_url</code> given in the response.</p>
<h4 id="check-login-status">Check Login Status<a class="headerlink" href="#check-login-status" title="Permanent link">&para;</a></h4>
<p>After the redirection, you can call the API:</p>
<p><code>GET /api/v1/auth/token?response_type=json</code></p>
<p>to check whether the login is success or whether the OAuth account is already linked to
a user. In the decoded JWT, there is a key <code>category</code>, which have two possible values: "
user" and "oauth".</p>
<p>If the value of <code>category</code> is empty, there should be some internal server error about
the oauth.</p>
<p>If the value of <code>category</code> is "user", you have already login. There is a
key <code>oauth_name</code> which indicates the OAuth service name you requested. The key <code>sub</code> is
the user id on the server. This is an example of the JWT payload of a successful login:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0b88d9ad-4351-415b-a656-cdc30124b93c&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1635504162</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">&quot;nbf&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1635504162</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="nt">&quot;jti&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ccab2e1d-4e28-443b-be0a-17952fd2e323&quot;</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1636713762</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;access&quot;</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">  </span><span class="nt">&quot;fresh&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">  </span><span class="nt">&quot;csrf&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2aaa82f2-f951-46fd-a09f-91006ad6d9d8&quot;</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">  </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">  </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tc-imba&quot;</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;liuyh615@126.com&quot;</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">  </span><span class="nt">&quot;student_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">  </span><span class="nt">&quot;real_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">  </span><span class="nt">&quot;oauth_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;github&quot;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="p">}</span>
</code></pre></div>
<p>If the value of <code>category</code> is "oauth", it means that we can't find a user related to the
OAuth account. The key <code>oauth_name</code> also indicates the OAuth service name you requested.
However, the other fields have different meanings. <code>sub</code> is the user id on the OAuth
service, and <code>username</code>, <code>email</code>, <code>student_id</code>, <code>real_name</code> are all obtained from the
OAuth service. You can display the information in the register page. See the register
section for details. This is an example of the JWT payload of an unsuccessful login
because of no user can be found by this OAuth account:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;006182C2-0B74-4FF6-9C1B-BEE57FF5076A&quot;</span><span class="p">,</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="nt">&quot;iat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1635506154</span><span class="p">,</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nt">&quot;nbf&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1635506154</span><span class="p">,</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="nt">&quot;jti&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;639fed64-dca3-4494-b1a0-3e4d9e15de68&quot;</span><span class="p">,</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="nt">&quot;exp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1636715754</span><span class="p">,</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;access&quot;</span><span class="p">,</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="nt">&quot;fresh&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="nt">&quot;csrf&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;d50d1e9f-82dd-47b6-8e4a-ef53bc3fb5ca&quot;</span><span class="p">,</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;oauth&quot;</span><span class="p">,</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;liuyh615&quot;</span><span class="p">,</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;liuyh615@sjtu.edu.cn&quot;</span><span class="p">,</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">  </span><span class="nt">&quot;student_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;515370910207&quot;</span><span class="p">,</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">  </span><span class="nt">&quot;real_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;刘逸灏&quot;</span><span class="p">,</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">  </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">  </span><span class="nt">&quot;oauth_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jaccount&quot;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="p">}</span>
</code></pre></div>
<h3 id="password-login-experimental">Password Login (Experimental)<a class="headerlink" href="#password-login-experimental" title="Permanent link">&para;</a></h3>
<p>If a user never set a password (this happens when they register via OAuth), he can not
use password login. Call the api to use password login:</p>
<p><code>POST /api/v1/auth/login</code></p>
<p><code>response_type</code> can be either <code>redirect</code> or <code>json</code> according to the client design.</p>
<p>Use the same check of <code>category</code> after the login, though the <code>category</code> can only be "
user" because no OAuth process is used. The JWT payload is same as the one in OAuth
where  <code>category</code> is "user", except that <code>oauth_name</code> will always be an empty string.</p>
<h3 id="register">Register<a class="headerlink" href="#register" title="Permanent link">&para;</a></h3>
<p>The register api is</p>
<p><code>POST /api/v1/auth/register</code></p>
<p>It accepts a JSON form:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="nt">&quot;oauth_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nt">&quot;oauth_account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="p">}</span>
</code></pre></div>
<p><code>username</code> and <code>email</code> must be unique in the site, we will examine it.</p>
<p><code>password</code> should be validated on client side (like input twice?). We haven't added any
restriction to the password on server side now.</p>
<h4 id="register-by-username-and-password">Register by Username and Password<a class="headerlink" href="#register-by-username-and-password" title="Permanent link">&para;</a></h4>
<p><code>oauth_name</code> and <code>oauth_account_id</code> should be set to empty string or null. An example of
the register form is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;liuyh615&quot;</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;liuyh615@126.com&quot;</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;drowssap&quot;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">}</span>
</code></pre></div>
<h4 id="register-by-oauth">Register by OAuth<a class="headerlink" href="#register-by-oauth" title="Permanent link">&para;</a></h4>
<p><code>oauth_name</code> and <code>oauth_account_id</code> must be provided together and match exactly what is
defined in JWT if this is a register by OAuth. You should use <code>oauth_name</code> in JWT
as <code>oauth_name</code> in the form and <code>sub</code> in JWT as <code>oauth_account_id</code> in the form. </p>
<p>You can omit any of <code>username</code> and <code>email</code> so that the server will use the same values 
in JWT. It's possible that <code>username</code> is already registered, the user must provide a 
new one in this case.</p>
<p>Note: <code>email</code> must be same as the primary email of the oauth account (the user can not 
change it), so it's recommended that you always omit it in the form.
If <code>email</code> is already registered, you should notify the user to bind the 
account instead of register a new one.</p>
<p><code>password</code> can also be omitted in a register by OAuth and the user may set it later
because the user can log in the account with OAuth now. A minimal example of the
register form is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;oauth_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jaccount&quot;</span><span class="p">,</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="nt">&quot;oauth_account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;006182C2-0B74-4FF6-9C1B-BEE57FF5076A&quot;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">}</span>
</code></pre></div>
<p>You can also provide a full register form:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;another_username&quot;</span><span class="p">,</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;liuyh615@sjtu.edu.cn&quot;</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;drowssap&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nt">&quot;oauth_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jaccount&quot;</span><span class="p">,</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">  </span><span class="nt">&quot;oauth_account_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;006182C2-0B74-4FF6-9C1B-BEE57FF5076A&quot;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="p">}</span>
</code></pre></div>
<p>Note that the <code>email</code> provided by OAuth is <code>liuyh615@sjtu.edu.cn</code>. You can overwrite it
by providing <code>liuyh615@126.com</code> in this form.</p>
<h3 id="logout-experimental">Logout (Experimental)<a class="headerlink" href="#logout-experimental" title="Permanent link">&para;</a></h3>
<p><code>POST /api/v1/auth/logout</code></p>
<p>It will delete all related cookies if the <code>cookie</code> parameter is set to true. It doesn't
have any other side effect now, because JWT is stateless. So if you clean the cookies on
client side, you don't even need to call this api.</p>
<p>Maybe we will add a parameter on this api to log out the OAuth account for the user.
This is because if we don't log out the OAuth account, the OAuth login will always log
in the same user.</p>
<h3 id="refresh-and-fresh-token-experimental">Refresh and Fresh Token (Experimental)<a class="headerlink" href="#refresh-and-fresh-token-experimental" title="Permanent link">&para;</a></h3>
<p><code>POST /api/v1/auth/refresh</code></p>
<p>The JWT access token usually have a short expire time (several days), and the JWT
refresh token have a longer one (maybe one month). After calling this api, two new JWT
access and refresh tokens are generated and their expiry time are refreshed. However,
the key <code>fresh</code> in the JWT access token is set to false.</p>
<p>The key idea of JWT refresh token is that it help reduce the login frequency of users.
For example, we mark some api endpoints such as changing password and updating profile
to require a fresh token, and other api endpoints don't need it. The user must log in
again to get a fresh token for certain endpoints.</p>
<p>Now we don't define any api endpoint which requires a fresh token, but we will make some
of them later. (GitHub also has this feature, we can refer to it.)</p>
<h3 id="link-account-with-oauth-not-implemented">Link Account with OAuth (Not Implemented)<a class="headerlink" href="#link-account-with-oauth-not-implemented" title="Permanent link">&para;</a></h3>
<p>Already supported in the DB design. User will be able to link more than one OAuth
account (but one each OAuth service) and login the same account via any of them.</p>
<h2 id="backends">Backends<a class="headerlink" href="#backends" title="Permanent link">&para;</a></h2>
<p>Currently, there are two authentication backends implemented: cookie backend and jwt
backend.</p>
<h3 id="cookie-authentication">Cookie Authentication<a class="headerlink" href="#cookie-authentication" title="Permanent link">&para;</a></h3>
<h4 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h4>
<p>If the <code>cookie</code> parameter is set to true in the authentication, two <code>HttpOnly</code>
cookies <code>access_token</code> and <code>refresh_token</code> are set, you can not get their values through
JavaScript for security reasons, and any future requests (both direct and fetch/XHR)
will automatically contain the cookies.</p>
<p>If CSRF protect is enabled (in production mode), two extra cookies <code>csrf_access_token</code>
and <code>csrf_refresh_token</code> are set, you can (and need to) get their value through
JavaScript because they are not <code>HttpOnly</code> cookies.</p>
<h4 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h4>
<p>For <code>GET</code> requests, you can call the APIs directly after the cookies are set.</p>
<p>For <code>POST</code>, <code>PUT</code>, <code>PATCH</code> and <code>DELETE</code> requests, you need to add a CSRF header in the
request header If CSRF protect is enabled:</p>
<p><code>X-CSRF-Token: &lt;csrf&gt;</code></p>
<p>If the CSRF header is not added, access is restricted to <code>GET</code> requests.</p>
<h3 id="http-authentication">HTTP Authentication<a class="headerlink" href="#http-authentication" title="Permanent link">&para;</a></h3>
<h4 id="introduction_1">Introduction<a class="headerlink" href="#introduction_1" title="Permanent link">&para;</a></h4>
<p>If the <code>response_type</code> parameter is set to "json", you will get a json response which
contains two token strings <code>access_token</code> and <code>refresh_token</code>. Both tokens are encoded
in jwt format and contains basic information about the current user.</p>
<p>you should not save the JWT anywhere, especially in long term storages (local storage,
session storage); in short-term storages such as global variables and DOM element, it's
also not recommended storing them to prevent XSS attacks. It seems that some long term
storages listed above are secure, but browser plugins may still be able to steal them.
So the correct thing to do is each time when initialization the frontend (or client),
get the JWT with an API:</p>
<p><code>GET /api/v1/auth/token?response_type=json</code></p>
<p>You can get the tokens if the <code>HttpOnly</code> cookies are correctly set in the
authentication, and no CSRF header is needed because it's a <code>GET</code> request. If you get
empty tokens, it means that you need to go through the auth process to login first.</p>
<h4 id="usage_1">Usage<a class="headerlink" href="#usage_1" title="Permanent link">&para;</a></h4>
<p>Add an authorization bearer with the JWT access token in the request header:</p>
<p><code>Authorization: Bearer &lt;access_token&gt;</code></p>
<p>You can use any HTTP method with HTTP Authentication. You do not need to add the CSRF
header because HTTP Authentication doesn't suffer from CSRF attacks.</p>
<h2 id="why-jwt">Why JWT?<a class="headerlink" href="#why-jwt" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://jwt.io/introduction">Introduction of JWT</a></p>
<p>JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed.</p>
</blockquote>
<p>Another common used authorization method in web application is session. In a session
setup, the client (browser) saves a session id (mostly in cookies), and the server saves
a map of session id to user information in the database (e.g. redis), or in memory (e.g.
memcache). The first method needs an extra table in the database, while the later method
can not preserve the data after a server restart.</p>
<p>However, JWT is only saved on client-side and verified on server-side, which means the
server doesn't need to save any information about logged-in users. This is called *
STATELESS*. What's more, since the server only need to do a verification, no I/O (
reading from the database or memory) is involved, the process will be typically faster
than session authorization.</p>
<p>There are three parts in JWT, header, payload and signature. Each part is in JSON format
and is transformed into base64 form when transmitting.</p>
<h3 id="header">Header<a class="headerlink" href="#header" title="Permanent link">&para;</a></h3>
<blockquote>
<p>The header typically consists of two parts: the type of the token, which is JWT, and the signing algorithm being used, such as HMAC SHA256 or RSA.</p>
<p>For example:</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HS256&quot;</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="nt">&quot;typ&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JWT&quot;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">}</span>
</code></pre></div>
<h3 id="payload">Payload<a class="headerlink" href="#payload" title="Permanent link">&para;</a></h3>
<blockquote>
<p>The second part of the token is the payload, which contains the claims. Claims are statements about an entity (typically, the user) and additional data.
</p>
</blockquote>
<p>Check the examples of JWT payload in <a href="#Process">Process</a>.</p>
<p>You can check the meaning of some official claims
in <a href="https://tools.ietf.org/html/rfc7519#section-4.1">RFC7519</a>.</p>
<h3 id="signature">Signature<a class="headerlink" href="#signature" title="Permanent link">&para;</a></h3>
<blockquote>
<p>To create the signature part you have to take the encoded header, the encoded payload, a secret, the algorithm specified in the header, and sign that.</p>
<p>For example if you want to use the HMAC SHA256 algorithm, the signature will be created in the following way:</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nx">HMACSHA256</span><span class="p">(</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="nx">base64UrlEncode</span><span class="p">(</span><span class="nx">header</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nx">base64UrlEncode</span><span class="p">(</span><span class="nx">payload</span><span class="p">),</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="nx">secret</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>The signature is used to verify the message wasn't changed along the way, and, in the case of tokens signed with a private key, it can also verify that the sender of the JWT is who it says it is.</p>
</blockquote>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<p>There are mainly three kinds of attack on web applications:</p>
<ul>
<li>man-in-the-middle (MitM) attacks: can be simply avoided with HTTPS protocol</li>
<li><a href="https://portswigger.net/web-security/cross-site-scripting">cross-site scripting (XSS) attacks</a>:
  the attacker uses malicious JavaScript and sends sensitive data (such as session id or
  JWT) to another server.</li>
<li><a href="https://portswigger.net/web-security/csrf">cross-site request forgery (CSRF) attacks</a>:
  the attacker causes the victim user to carry out an action unintentionally.</li>
</ul>
<p>We use these techniques to enhance the security of the website:</p>
<ul>
<li>Do not save any sensitive data or token in Local Storage and Session Storage. Use
  cookies instead.</li>
<li>Use the <code>Secure</code> attribute so that a cookie is sent to the server only with an
  encrypted request over the HTTPS protocol, never with unsecured HTTP (except on
  localhost)</li>
<li>Use the <code>HttpOnly</code> attribute to prevent access to cookie values via JavaScript.</li>
<li>Use the <code>SameSite</code> attribute and a CSRF token to prevent CSRF attacks</li>
</ul>
<p>Local Storage and Session Storage are insecure because any JavaScript can access the
contents of these storages and send them to a remote server. Although we can prevent the
injection of malicious code to our website, the client users are very likely to have a
bunch of Chrome/Firefox extensions installed which can also access these storages.
Similarly, a cookie without the <code>HttpOnly</code> attribute is also open to JavaScript.</p>
<blockquote>
<p>This isn't the full story. However now we can keep our cookies from being stolen via XSS attacks, but session cookies vulnerable to CSRF attacks.</p>
</blockquote>
<p>We add a random CSRF Token in the JWT, and also set a cookie containing the CSRF Token
without the <code>HttpOnly</code> attribute so that the client can retrieve it by JavaScript. When
the client makes a <code>POST</code>, <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code> request, an extra <code>X-CSRF-Token</code>
header must be added to request headers. The server can compare the CSRF token in the
JWT (via cookie) and that in the header to verify the client.</p>
<p>Now the XSS attackers only know the CSRF token, and the CSRF attackers don't know the
CSRF token, so both of them can not perform an attack.</p>
<p>However, no system is safe. If an attacker can perform XSS and CSRF attacks at the same
time, the CSRF attack will be successful.</p>
<p>Check
this <a href="https://indominusbyte.github.io/fastapi-jwt-auth/usage/jwt-in-cookies/">reference</a>
for details.</p>
<h2 id="third-party-login-support">Third-party Login Support<a class="headerlink" href="#third-party-login-support" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="http://developer.sjtu.edu.cn/wiki/JAccount">JAccount</a></li>
<li><a href="https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps">GitHub</a></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>